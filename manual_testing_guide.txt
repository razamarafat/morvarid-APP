
===================================================================
راهنمای تست دستی سامانه مدیریت یکپارچه مروارید (نسخه 2.6.4)
===================================================================

این فایل شامل سناریوهای تست قدم‌به‌قدم برای اطمینان از عملکرد صحیح سیاست‌های امنیتی، 
مدت زمان نشست، و دسترسی‌های نقش‌های مختلف (Admin, Registration, Sales) می‌باشد.

-------------------------------------------------------------------
سناریو ۱: تست انقضای نشست (Session Timeout)
-------------------------------------------------------------------
هدف: اطمینان از اینکه کاربر پس از ۱ ساعت بی‌فعالیتی به طور خودکار خارج می‌شود.

۱. با هر کاربری (مثلاً ادمین) وارد سیستم شوید.
۲. کلید F12 را بزنید و به تب Application > Local Storage بروید.
۳. مقدار کلید `morvarid_last_activity` را پیدا کنید.
۴. مقدار آن را به صورت دستی تغییر دهید (مثلاً عدد را به ۲ ساعت قبل کاهش دهید - یعنی ۷۲۰۰۰۰۰ میلی‌ثانیه کم کنید).
   * نکته: می‌توانید از Console استفاده کنید: 
     localStorage.setItem('morvarid_last_activity', (Date.now() - 3700000).toString())
۵. حالا روی هر جای صفحه کلیک کنید یا صفحه را رفرش کنید.
۶. انتظار: سیستم باید بلافاصله شما را Log out کند و به صفحه ورود هدایت شوید. پیام "مدت زمان نشست به پایان رسیده" باید نمایش داده شود.

-------------------------------------------------------------------
سناریو ۲: تست محدودیت ویرایش ۵ ساعته (برای کاربران عادی)
-------------------------------------------------------------------
هدف: اطمینان از اینکه مسئول ثبت فقط تا ۵ ساعت پس از ایجاد رکورد می‌تواند آن را ویرایش/حذف کند.

۱. با نقش "مسئول ثبت" (Registration) وارد شوید.
۲. یک آمار تولید جدید برای امروز ثبت کنید.
۳. به تب "سوابق" (Recent Records) بروید.
۴. باید دکمه‌های ویرایش (مداد) و حذف (سطل زباله) را روی کارت مربوطه ببینید.
۵. انتظار: دکمه‌ها فعال هستند و می‌توانید ویرایش کنید.
۶. (تست منفی): حالا ساعت سیستم عامل خود را ۶ ساعت جلو ببرید (یا در دیتابیس created_at رکورد را به ۶ ساعت قبل تغییر دهید).
۷. صفحه را رفرش کنید.
۸. انتظار: دکمه‌های ویرایش و حذف باید ناپدید شوند یا با آیکون قفل (Lock) جایگزین شده باشند.

-------------------------------------------------------------------
سناریو ۳: تست دسترسی نامحدود مدیر (Super Admin Edit)
-------------------------------------------------------------------
هدف: اطمینان از اینکه مدیر سیستم محدودیت زمانی برای ویرایش ندارد.

۱. همان رکوردی که در سناریوی ۲ (با تاریخ قدیمی) ایجاد شد را در نظر بگیرید.
۲. با اکانت "مدیر" (Admin) وارد شوید.
۳. به بخش "گزارشات" و تب "آمار تولید" بروید.
۴. همان رکورد را پیدا کنید.
۵. انتظار: با وجود اینکه بیش از ۵ ساعت گذشته است، مدیر باید دکمه ویرایش را ببیند و بتواند تغییرات اعمال کند.
۶. تغییرات را ذخیره کنید. سیستم باید پیام "ویرایش با دسترسی مدیریت" را نمایش دهد.

-------------------------------------------------------------------
سناریو ۴: تست امنیت داده‌ها (RLS - Row Level Security)
-------------------------------------------------------------------
هدف: اطمینان از اینکه هر کاربر فقط فارم‌های خودش را می‌بیند.

۱. دو کاربر متفاوت بسازید:
   - کاربر A: تخصیص داده شده به "فارم ۱"
   - کاربر B: تخصیص داده شده به "فارم ۲"
۲. با کاربر A وارد شوید و یک آمار ثبت کنید.
۳. خارج شوید و با کاربر B وارد شوید.
۴. به داشبورد یا گزارشات بروید.
۵. انتظار: کاربر B نباید هیچ رکوردی از کاربر A یا "فارم ۱" را ببیند. لیست فارم‌ها در دراپ‌داون فقط باید شامل "فارم ۲" باشد.

-------------------------------------------------------------------
سناریو ۵: تست جلوگیری از ثبت تکراری (Duplicate Check)
-------------------------------------------------------------------
هدف: اطمینان از اینکه برای یک فارم/تاریخ/محصول، دو بار آمار ثبت نمی‌شود.

۱. با مسئول ثبت وارد شوید.
۲. برای "فارم ۱"، تاریخ "امروز"، محصول "کودی" آمار ثبت کنید.
۳. دوباره وارد فرم ثبت آمار شوید.
۴. سعی کنید برای همان فارم/تاریخ/محصول مجدداً عدد وارد کنید.
۵. انتظار: سیستم باید یا اجازه ثبت ندهد (فیلد غیرفعال باشد/پیام "ثبت شده" بدهد) یا اگر دکمه ثبت را زدید، پیام خطا دهد که "این رکورد قبلاً ثبت شده است".
   * در نسخه فعلی: کارت محصول باید سبز رنگ و با تیک "ثبت شده" نمایش داده شود.

-------------------------------------------------------------------
سناریو ۶: تست آفلاین و همگام‌سازی (PWA Sync)
-------------------------------------------------------------------
هدف: اطمینان از اینکه در صورت قطع اینترنت، اطلاعات از دست نمی‌رود.

۱. اینترنت دستگاه را قطع کنید (Offline Mode).
۲. یک آمار یا حواله جدید ثبت کنید.
۳. انتظار: پیام "ذخیره در صف آفلاین" نمایش داده شود.
۴. به نشانگر وضعیت (بالای صفحه سمت چپ) نگاه کنید. باید "آفلاین" یا "در انتظار ارسال" باشد.
۵. اینترنت را وصل کنید.
۶. انتظار: پس از چند ثانیه، سیستم باید خودکار اطلاعات را ارسال کند و پیام "همگام‌سازی موفق" بدهد.

-------------------------------------------------------------------
سناریو ۷: تست دسترسی‌های روت (Protected Routes)
-------------------------------------------------------------------
هدف: اطمینان از اینکه کاربر فروش نمی‌تواند به پنل ادمین برود.

۱. با نقش "مسئول فروش" (Sales) وارد شوید.
۲. در نوار آدرس مرورگر، آدرس را به `/admin` تغییر دهید و Enter بزنید.
۳. انتظار: سیستم باید شما را بلافاصله به داشبورد فروش (`/sales`) یا صفحه ورود برگرداند. نباید محتوای صفحه ادمین دیده شود.

===================================================================
پایان راهنما
با احترام، دستیار هوشمند توسعه‌دهنده
===================================================================
